---
- name: Add influxdb repository
  become: true
  yum_repository: 
    name: influxdb
    description: InfluxDB Repository - RHEL $releasever
    baseurl: https://repos.influxdata.com/rhel/{{ ansible_distribution_major_version }}/$basearch/stable
    enabled: 1
    gpgcheck: 1
    gpgkey: https://repos.influxdata.com/influxdata-archive_compat.key
    exclude: influxdb2* influxdb2-cli*

- name: Remove influxdb2-cli if present (avoid conflicts with influxdb 1.x)
  become: true
  yum:
    name: influxdb2-cli
    state: absent

- name: Install InfluxDB
  vars: 
    package_name: 
      - influxdb
    package_state: latest
  include_role: 
    name: safe_yum

- name: install influx pip
  become: true
  pip:
    name: influxdb
    executable: pip3